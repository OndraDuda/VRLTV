<!DOCTYPE html>
<html lang="cs">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VRL - Velocity Racing League - Season 2</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <div id="snowContainer"></div>
    <header>
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <a href="index.html">
                        <img src="vrl_high_res.png" alt="F1 VRL Logo" class="logo-img">
                    </a>
                </div>
                <div class="header-controls">
                    <button class="theme-switch" id="themeSwitch">
                        <i class="fas fa-moon"></i>
                    </button>
                    <button class="mobile-menu-toggle" id="mobileMenuToggle">
                        <span></span>
                        <span></span>
                        <span></span>
                    </button>
                </div>
                <nav id="mobileNav">
                    <ul>
                        <li><a href="index.html">Domů</a></li>
                        <li><a href="calendar.html">Kalendář</a></li>
                        <li><a href="jezdci.html">Jezdci</a></li>
                        <li><a href="tymy.html">Týmy</a></li>
                        <li><a href="okruh.html">Okruhy</a></li>
                        <li><a href="vysledky.html">Výsledky</a></li>
                        <li><a href="prihlasky.html">Příhlášky</a></li>
                        <li><a href="https://discord.gg/CMxscEUcRd" class="discord-btn"><i class="fab fa-discord"></i>
                                Discord</a></li>
                    </ul>
                </nav>
            </div>
        </div>
    </header>

    <section class="hero">
        <div class="hero-fade"></div>
        <div class="container">
            <div class="hero-content">
                <h2>Velocity Racing League</h2>
                <p>Zjisti jak jsou na tom tvé oblíbené týmy.</p>
                <div>
                    <a href="https://discord.gg/CMxscEUcRd" class="btn"><i class="fab fa-discord"></i> Připojit se na
                        Discord</a>
                </div>
            </div>
        </div>
    </section>

    <main>
        <h2 class="table-title">Pořadí týmy</h2>
        <table class="teams-table">
            <thead>
                <tr>
                    <th>Pořadí</th>
                    <th>Tým</th>
                    <th>Body</th>
                    <th>Ztráta</th>
                    <th>1. místa</th>
                    <th>2. místa</th>
                    <th>3. místa</th>
                </tr>
            </thead>
            <tbody id="teamsTableBody"></tbody>
        </table>

        <!-- Přidání sekce s grafem -->
        <div class="points-chart-section">
            <h2 class="section-title">Vývoj bodů týmů v sezóně</h2>
            <div class="chart-container">
                <canvas id="teamsChart"></canvas>
            </div>
        </div>
    </main>

    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3>VRL</h3>
                    <p>Virtuální závodní liga pro nadšence Formule 1. Připoj se k nám a zažij motorsport z pohodlí
                        domova.</p>
                    <div class="social-icons">
                        <a href="https://www.instagram.com/vrl_velocityracingleague/"><i
                                class="fab fa-instagram"></i></a>
                        <a href="https://www.youtube.com/@Velocity_Racing_League_VRL"><i class="fab fa-youtube"></i></a>
                        <a href="https://discord.gg/CMxscEUcRd"><i class="fab fa-discord"></i></a>
                        <a href="https://www.tiktok.com/@velocity_racingleague" target="_blank"><i
                                class="fab fa-tiktok"></i></a>
                    </div>
                </div>
                <div class="footer-section">
                    <h3>Navigace</h3>
                    <ul>
                        <li><a href="index.html">Domů</a></li>
                        <li><a href="calendar.html">Kalendář</a></li>
                        <li><a href="jezdci.html">Jezdci</a></li>
                        <li><a href="tymy.html">Týmy</a></li>
                        <li><a href="okruh.html">Okruhy</a></li>
                        <li><a href="vysledky.html">Výsledky</a></li>
                        <li><a href="prihlasky.html">Příhlášky</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h3>Organizátoři</h3>
                    <ul>
                        <li><a href="https://www.instagram.com/matyaasko/">Matěj Vaculík</a></li>
                        <li><a href="https://www.instagram.com/beeeeuuuuu/">Maxim Heligr</a></li>
                        <li><a href="https://www.instagram.com/_.duda.o._/">Ondra Duda</a></li>
                        <li><a href="https://www.instagram.com/klabochmartin?igsh=Ym1pN29hNTFmbjBx&utm_source=qr">Martin
                                Klaboch</a></li>
                        <li><a href="https://www.instagram.com/olinkkt/">Oliver Seidl</a></li>
                    </ul>
                </div>
            </div>
            <div class="copyright">
                <p>&copy; 2025 VRL. Všechna práva vyhrazena.</p>
            </div>
        </div>
    </footer>

    <script src="js/global.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        // Definice aktuálních jezdců v týmech
        const currentTeamDrivers = {
            'McLaren': ['Maxim Heligr', 'Matěj Vaculík'],
            'Mercedes': ['Martin Klaboch', 'Zdeněk Pohlreich'],
            'Ferrari': ['Josef Kubeš', 'Luboš Novotný'],
            'Aston Martin': ['Matyáš Kasl', 'Filip Kratochvil'],
            'Williams': ['Matěj Csiba', 'Oliver Maťko'],
            'Haas': ['Tomáš Novák', 'Štěpán Hlavač'],
            'Sauber': ['Oliver Stavač', 'Jakub Fabian'],
            'Racing Bulls': ['Andrej Erdelský', 'Jáchym Majvald'],
            'Alpine': ['Oliver Čobrda', 'Jan Bubák'],
            'Red Bull': ['David Miloš', 'Štěpán Veselý']
        };

        // Data závodů z výsledků
        const raceResults = [
            {
                round: "R1 – Melbourne Grand Prix Circuit",
                results: [
                    { name: "Josef Kubeš", team: "Ferrari", country: "cz", points: 25 },
                    { name: "Martin Klaboch", team: "Mercedes", country: "cz", points: 18 },
                    { name: "Maxim Heligr", team: "McLaren", country: "cz", points: 15 },
                    { name: "Matěj Csiba", team: "Williams", country: "sk", points: 12 },
                    { name: "Oliver Maťko", team: "Ferrari", country: "sk", points: 10 },
                    { name: "Andrej Erdelský", team: "Racing Bulls", country: "sk", points: 8 },
                    { name: "Tadeáš Šmídl", team: "Red Bull", country: "cz", points: 6 },
                    { name: "Tomáš Novák", team: "Haas", country: "cz", points: 4 },
                    { name: "Matěj Vaculík", team: "McLaren", country: "cz", points: 2 },
                    { name: "Matěj Doha", team: "Alpine", country: "cz", points: 1 }
                ]
            },
            {
                round: "R2 – Silverstone Circuit",
                results: [
                    { name: "Maxim Heligr", team: "McLaren", country: "cz", points: 25 },
                    { name: "Martin Klaboch", team: "Mercedes", country: "cz", points: 18 },
                    { name: "Matěj Vaculík", team: "McLaren", country: "cz", points: 15 },
                    { name: "Josef Kubeš", team: "Ferrari", country: "cz", points: 12 },
                    { name: "Oliver Maťko", team: "Aston Martin", country: "sk", points: 10 },
                    { name: "Filip Kratochvil", team: "Aston Martin", country: "cz", points: 8 },
                    { name: "Tomáš Novák", team: "Haas", country: "cz", points: 6 },
                    { name: "Luboš Novotný", team: "Ferrari", country: "cz", points: 4 },
                    { name: "Andrej Erdelský", team: "Racing Bulls", country: "sk", points: 2 },
                    { name: "Jakub Fabian", team: "Sauber", country: "cz", points: 1 }
                ]
            },
            {
                round: "R3 – Bahrain International Circuit",
                results: [
                    { name: "Maxim Heligr", team: "McLaren", country: "cz", points: 25 },
                    { name: "Martin Klaboch", team: "Mercedes", country: "cz", points: 18 },
                    { name: "Matyáš Kasl", team: "Williams", country: "cz", points: 15 },
                    { name: "Oliver Maťko", team: "Aston Martin", country: "sk", points: 12 },
                    { name: "Tomáš Novák", team: "Haas", country: "cz", points: 10 },
                    { name: "Josef Kubeš", team: "Ferrari", country: "cz", points: 8 },
                    { name: "Matěj Vaculík", team: "McLaren", country: "cz", points: 6 },
                    { name: "Oliver Stavač", team: "Sauber", country: "sk", points: 4 },
                    { name: "Zdeněk Pohlreich", team: "Mercedes", country: "cz", points: 2 },
                    { name: "Jakub Fabian", team: "Sauber", country: "cz", points: 1 }
                ]
            },
            {
                round: "R4 – Miami International Autodrome",
                results: [
                    { name: "Maxim Heligr", team: "McLaren", country: "cz", points: 25 },
                    { name: "Matěj Csiba", team: "Williams", country: "sk", points: 18 },
                    { name: "Filip Kratochvil", team: "Aston Martin", country: "cz", points: 15 },
                    { name: "Oliver Maťko", team: "Aston Martin", country: "sk", points: 12 },
                    { name: "Matěj Vaculík", team: "McLaren", country: "cz", points: 10 },
                    { name: "Oliver Stavač", team: "Sauber", country: "sk", points: 8 },
                    { name: "Tomáš Novák", team: "Haas", country: "cz", points: 6 },
                    { name: "Andrej Erdelský", team: "Racing Bulls", country: "sk", points: 4 },
                    { name: "Josef Kubeš", team: "Ferrari", country: "cz", points: 2 },
                    { name: "Viktor Koutný", team: "Red Bull", country: "cz", points: 1 }
                ]
            },
            {
                round: "R5 – Autodromo Enzo e Dino Ferrari (Imola)",
                results: [
                    { name: "Filip Kratochvil", team: "Aston Martin", country: "cz", points: 25 },
                    { name: "Tomáš Novák", team: "Haas", country: "cz", points: 18 },
                    { name: "Zdeněk Pohlreich", team: "Mercedes", country: "cz", points: 15 },
                    { name: "Maxim Heligr", team: "McLaren", country: "cz", points: 12 },
                    { name: "Josef Kubeš", team: "Ferrari", country: "cz", points: 10 },
                    { name: "Matěj Csiba", team: "Williams", country: "sk", points: 8 },
                    { name: "Martin Klaboch", team: "Mercedes", country: "cz", points: 6 },
                    { name: "Oliver Stavač", team: "Sauber", country: "sk", points: 4 },
                    { name: "Oliver Maťko", team: "Williams", country: "sk", points: 2 },
                    { name: "Matěj Švec", team: "Haas", country: "cz", points: 1 }
                ]
            },
            {
                round: "R6 – Baku City Circuit",
                results: [
                    { name: "Martin Klaboch", team: "Mercedes", country: "cz", points: 25 },
                    { name: "Josef Kubeš", team: "Ferrari", country: "cz", points: 18 },
                    { name: "Maxim Heligr", team: "McLaren", country: "cz", points: 15 },
                    { name: "Oliver Stavač", team: "Sauber", country: "sk", points: 12 },
                    { name: "Jakub Fabian", team: "Sauber", country: "cz", points: 10 },
                    { name: "Luboš Novotný", team: "Ferrari", country: "cz", points: 8 },
                    { name: "Matěj Vaculík", team: "McLaren", country: "cz", points: 6 },
                    { name: "Andrej Erdelský", team: "Racing Bulls", country: "sk", points: 4 },
                ]
            },
            {
                round: "R7 – Suzuka International Racing Course",
                results: [
                    { name: "Filip Kratochvil", team: "Aston Martin", country: "cz", points: 25 },
                    { name: "Maxim Heligr", team: "McLaren", country: "cz", points: 18 },
                    { name: "Matěj Vaculík", team: "McLaren", country: "cz", points: 15 },
                    { name: "Josef Kubeš", team: "Ferrari", country: "cz", points: 12 },
                    { name: "Martin Klaboch", team: "Mercedes", country: "cz", points: 10 },
                    { name: "Oliver Stavač", team: "Sauber", country: "sk", points: 8 },
                    { name: "Jakub Fabian", team: "Sauber", country: "cz", points: 6 },
                    { name: "Oliver Čobrda", team: "Alpine", country: "cz", points: 4 },
                    { name: "Andrej Erdelský", team: "Racing Bulls", country: "sk", points: 2 },
                    { name: "Ján Bubák", team: "Williams", country: "sk", points: 1 }
                ]
            },
            {
                round: "R8 – Circuit Gilles Villeneuve",
                results: [
                    { name: "Max Novotný", team: "Williams", country: "sk", points: 25 },
                    { name: "Matyáš Kasl", team: "Aston Martin", country: "cz", points: 18 },
                    { name: "Maxim Heligr", team: "McLaren", country: "cz", points: 15 },
                    { name: "Martin Klaboch", team: "Mercedes", country: "cz", points: 12 },
                    { name: "Josef Kubeš", team: "Ferrari", country: "cz", points: 10 },
                    { name: "Oliver Stavač", team: "Sauber", country: "sk", points: 8 },
                    { name: "Matěj Vaculík", team: "McLaren", country: "cz", points: 6 },
                    { name: "Tomáš Novák", team: "Haas", country: "cz", points: 4 },
                    { name: "Jakub Fabian", team: "Sauber", country: "cz", points: 2 },
                    { name: "Andrej Erdelský", team: "Racing Bulls", country: "sk", points: 1 },
                ]
            },
            {
                round: "R9 – Marina Bay Street Circuit",
                results: [
                    { name: "Martin Klaboch", team: "Mercedes", country: "cz", points: 25 },
                    { name: "Jakub Fabian", team: "Sauber", country: "cz", points: 18 },
                    { name: "Oliver Stavač", team: "Sauber", country: "sk", points: 15 },
                    { name: "Josef Kubeš", team: "Ferrari", country: "cz", points: 12 },
                    { name: "Andrej Erdelský", team: "Racing Bulls", country: "sk", points: 10 },
                    { name: "Zdeněk Pohlreich", team: "Mercedes", country: "cz", points: 8 },
                    { name: "Tomáš Novák", team: "Haas", country: "cz", points: 6 }
                ]
            },
            {
                round: "R10 – Circuit de Spa-Francorchamps",
                results: [
                    { name: "Maxim Heligr", team: "McLaren", country: "cz", points: 25 },
                    { name: "Filip Kratochvil", team: "Aston Martin", country: "cz", points: 18 },
                    { name: "Oliver Maťko", team: "Williams", country: "sk", points: 15 },
                    { name: "Andrej Erdelský", team: "Racing Bulls", country: "sk", points: 12 },
                    { name: "Zdeněk Pohlreich", team: "Mercedes", country: "cz", points: 10 },
                    { name: "Matěj Vaculík", team: "McLaren", country: "cz", points: 8 },
                    { name: "Oliver Stavač", team: "Sauber", country: "sk", points: 6 },
                    { name: "Josef Kubeš", team: "Ferrari", country: "cz", points: 4 },
                ]
            },
        ];

        // Funkce pro výpočet statistik týmů
        function calculateTeamStats() {
            const teams = {};

            // Projdeme všechny závody
            raceResults.forEach(race => {
                // Projdeme všechny výsledky v závodě
                race.results.forEach(result => {
                    const teamName = result.team;

                    // Pokud tým ještě neexistuje, vytvoříme ho
                    if (!teams[teamName]) {
                        teams[teamName] = {
                            points: 0,
                            wins: 0,
                            second: 0,
                            third: 0,
                            drivers: new Set(),
                            racePoints: {} // Body za každý závod
                        };
                    }

                    // Přidáme body týmu
                    teams[teamName].points += result.points;

                    // Přidáme jezdce do týmu (všichni co kdy bodovali)
                    teams[teamName].drivers.add(result.name);

                    // Spočítáme umístění
                    if (result.points === 25) teams[teamName].wins++;
                    if (result.points === 18) teams[teamName].second++;
                    if (result.points === 15) teams[teamName].third++;

                    // Uložíme body za tento závod
                    const raceKey = race.round.split(' – ')[0];
                    if (!teams[teamName].racePoints[raceKey]) {
                        teams[teamName].racePoints[raceKey] = 0;
                    }
                    teams[teamName].racePoints[raceKey] += result.points;
                });
            });

            return teams;
        }

        // Funkce pro vytvoření kumulativních bodů pro graf
        function calculateCumulativePoints(teams) {
            const raceOrder = raceResults.map(race => race.round.split(' – ')[0]);
            const cumulativeData = {};

            // Pro každý tým
            Object.keys(teams).forEach(team => {
                cumulativeData[team] = [];
                let cumulative = 0;

                // Pro každý závod v pořadí
                raceOrder.forEach(race => {
                    const pointsInRace = teams[team].racePoints[race] || 0;
                    cumulative += pointsInRace;
                    cumulativeData[team].push(cumulative);
                });
            });

            return cumulativeData;
        }

        // Funkce pro vyplnění tabulky týmů
        function populateTeamsTable() {
            const teams = calculateTeamStats();
            const tableBody = document.getElementById('teamsTableBody');
            tableBody.innerHTML = '';

            // Převod na pole a seřazení podle bodů
            const sortedTeams = Object.entries(teams)
                .map(([team, stats]) => ({
                    team,
                    ...stats,
                    // Použijeme aktuální jezdce z definice currentTeamDrivers
                    currentDrivers: currentTeamDrivers[team] || Array.from(stats.drivers)
                }))
                .sort((a, b) => b.points - a.points);

            const leaderPoints = sortedTeams[0].points;

            // Vyplnění tabulky
            sortedTeams.forEach((team, index) => {
                const loss = leaderPoints - team.points;
                const row = document.createElement("tr");
                row.innerHTML = `
                    <td><strong>${index + 1}</strong></td>
                    <td class="team-cell" data-drivers="${team.currentDrivers.join(', ')}">${team.team}</td>
                    <td><strong>${team.points}</strong></td>
                    <td>${loss === 0 ? "-" : loss}</td>
                    <td>${team.wins}</td>
                    <td>${team.second}</td>
                    <td>${team.third}</td>
                `;
                tableBody.appendChild(row);
            });

            return teams;
        }

        // Funkce pro vytvoření grafu
        function createTeamsChart(teams) {
            const ctx = document.getElementById('teamsChart').getContext('2d');

            // Získání pořadí závodů
            const raceOrder = raceResults.map(race => race.round.split(' – ')[0]);

            // Barvy týmů
            const teamColors = {
                'McLaren': '#FF8000',
                'Mercedes': '#00D2BE',
                'Ferrari': '#DC0000',
                'Aston Martin': '#006F62',
                'Williams': '#005AFF',
                'Haas': '#FFFFFF',
                'Sauber': '#9B0000',
                'Racing Bulls': '#0032FF',
                'Alpine': '#0090FF',
                'Red Bull': '#0600EF'
            };

            // Výpočet kumulativních bodů
            const cumulativeData = calculateCumulativePoints(teams);

            // Příprava datasetů
            const datasets = Object.keys(cumulativeData).map(team => {
                return {
                    label: team,
                    data: cumulativeData[team],
                    borderColor: teamColors[team] || '#CCCCCC',
                    backgroundColor: teamColors[team] ? teamColors[team] + '20' : '#CCCCCC20',
                    tension: 0.3,
                    fill: false,
                    pointBackgroundColor: teamColors[team] || '#CCCCCC',
                    pointBorderColor: '#ffffff',
                    pointBorderWidth: 2,
                    pointRadius: 4
                };
            });

            // Vytvoření grafu
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: raceOrder,
                    datasets: datasets
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top'
                        },
                        title: {
                            display: true,
                            text: 'Kumulativní body týmů během sezóny'
                        },
                        tooltip: {
                            mode: 'index',
                            intersect: false,
                            // Kompletně nahrazujeme obsah tooltipu
                            callbacks: {
                                title: function (context) {
                                    // Vrátíme název závodu jako titulek
                                    return context[0].label;
                                },
                                label: function () {
                                    // Potlačíme standardní labely
                                    return '';
                                },
                                afterBody: function (context) {
                                    const dataIndex = context[0].dataIndex;
                                    const datasetValues = [];

                                    // Shromáždění hodnot pro všechny týmy v daném závodě
                                    context.forEach(item => {
                                        datasetValues.push({
                                            label: item.dataset.label,
                                            value: item.parsed.y,
                                            color: item.dataset.borderColor
                                        });
                                    });

                                    // Seřazení podle hodnoty sestupně
                                    datasetValues.sort((a, b) => b.value - a.value);

                                    // Vytvoření seřazeného seznamu jako jediný obsah tooltipu
                                    let tooltipContent = [];
                                    datasetValues.forEach((item, index) => {
                                        tooltipContent.push(`${index + 1}. ${item.label}: ${item.value} bodů`);
                                    });

                                    return tooltipContent;
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Kumulativní body'
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'Závody'
                            }
                        }
                    },
                    interaction: {
                        mode: 'nearest',
                        axis: 'x',
                        intersect: false
                    }
                }
            });
        }

        // Inicializace po načtení stránky
        document.addEventListener('DOMContentLoaded', () => {
            const teams = populateTeamsTable();
            createTeamsChart(teams);

            // Tooltip pro zobrazení jezdců v týmu
            const tooltip = document.createElement('div');
            tooltip.style.position = 'absolute';
            tooltip.style.background = 'rgba(0,0,0,0.8)';
            tooltip.style.color = '#fff';
            tooltip.style.padding = '5px 10px';
            tooltip.style.borderRadius = '5px';
            tooltip.style.display = 'none';
            tooltip.style.zIndex = '1000';
            document.body.appendChild(tooltip);

            document.querySelectorAll('.team-cell').forEach(cell => {
                cell.addEventListener('mouseenter', e => {
                    tooltip.textContent = 'Aktuální jezdci: ' + cell.dataset.drivers;
                    tooltip.style.display = 'block';
                });
                cell.addEventListener('mousemove', e => {
                    tooltip.style.top = e.pageY + 10 + 'px';
                    tooltip.style.left = e.pageX + 10 + 'px';
                });
                cell.addEventListener('mouseleave', () => {
                    tooltip.style.display = 'none';
                });
            });
        });
    </script>
</body>

</html>
