<!DOCTYPE html>
<html lang="cs">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VRL - Velocity Racing League - Season 2</title>
    <link rel="icon" type="image/png" href="VRL_logo_nove.png">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <header>
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <a href="index.html">
                        <img src="vrl_high_res.png" alt="F1 VRL Logo" class="logo-img">
                    </a>
                </div>
                <div class="header-controls">
                    <button class="theme-switch" id="themeSwitch">
                        <i class="fas fa-moon"></i>
                    </button>
                    <button class="mobile-menu-toggle" id="mobileMenuToggle">
                        <span></span>
                        <span></span>
                        <span></span>
                    </button>
                </div>
                <nav id="mobileNav">
                    <ul>
                        <li><a href="index.html">Domů</a></li>
                        <li><a href="calendar.html">Kalendář</a></li>
                        <li><a href="jezdci.html">Jezdci</a></li>
                        <li><a href="tymy.html">Týmy</a></li>
                        <li><a href="okruh.html">Okruhy</a></li>
                        <li><a href="vysledky.html">Výsledky</a></li>
                        <li><a href="prihlasky.html">Příhlášky</a></li>
                        <li><a href="https://discord.gg/CMxscEUcRd" class="discord-btn"><i class="fab fa-discord"></i>
                                Discord</a></li>
                    </ul>
                </nav>
            </div>
        </div>
    </header>

    <section class="hero">
        <div class="hero-fade"></div>
        <div class="container">
            <div class="hero-content">
                <h2>Velocity Racing League</h2>
                <p>Druhá sezóna VRL je v plném proudu.</p>
                <div>
                    <a href="https://discord.gg/CMxscEUcRd" class="btn"><i class="fab fa-discord"></i> Připojit se na
                        Discord</a>
                </div>
            </div>
        </div>
    </section>

    <div class="container">
        <section class="season-info">
            <h2>SEZÓNA 2 - DŮLEŽITÉ INFORMACE</h2>
            <p>Druhá sezóna VRL přináší nové okruhy a ještě více napětí!</p>
            <div class="season-details">
                <div class="detail-card">
                    <h3><i class="fas fa-calendar-alt"></i> Formát</h3>
                    <p>20 závodů<br>2 části sezóny<br>Short kvalifikace<br>50% závody</p>
                </div>

                <div class="detail-card">
                    <h3><i class="fas fa-trophy"></i> Bodování</h3>
                    <p>1. Místo 25<br>2. Místo 18<br>3. Místo 15<br>12-10-8-6-4-2-1</p>
                </div>

                <div class="detail-card">
                    <h3><i class="fas fa-gamepad"></i> Platforma</h3>
                    <p>F1 25<br> PC Steam/EA<br>PS/Xbox</p>
                </div>

                <div class="detail-card">
                    <h3><i class="fas fa-book"></i> Pravidla</h3>
                    <p>Pravidla ligy a závodění</p>
                    <a href="https://docs.google.com/document/d/1o9ULOGPHiwvApBRguubZ3BCT3zQkdIPZtWpjO5tcUpc/edit?tab=t.0"
                        class="btn"> Pravidla</a>
                </div>
            </div>
        </section>

        <section class="news-section">
            <h2 class="section-title">Novinky</h2>

            <div class="news-grid">
                <article class="news-card">
                    <div class="news-content">
                        <h3>VRL SMP – Nový Minecraft projekt!</h3>
                        <p>Představujeme VRL SMP, komunitní Minecraft server pro všechny fanoušky VRL.</p>
                        <a href="novinky1.html" class="btn">Číst více</a>
                    </div>
                </article>

                <article class="news-card">
                    <div class="news-content">
                        <h3>VC Azerbajdžánu</h3>
                        <p>Souhrn Věcí co se talo ve Velké Ceně Azerbajdžánu</p>
                        <a href="novinky2.html" class="btn">Číst více</a>
                    </div>
                </article>
            </div>
        </section>

        <h2 class="section-title">Další Závod</h2>
        <!-- Sekce Další závod -->
        <section class="next-race-section">
            <div class="next-race-container">
                <!-- Informace o nadcházejícím závodě -->
                <div class="next-race-info" id="nextRaceInfo">
                    <div class="race-basic-info">
                        <h3 id="nextRaceName">--</h3>
                        <p class="race-track" id="nextRaceTrack">--</p>
                        <p class="race-datetime" id="nextRaceDateTime">--</p>
                    </div>
                </div>

                <!-- Countdown a stream status -->
                <div class="race-status">
                    <!-- LIVE indikátor -->
                    <div class="live-indicator hidden" id="liveIndicator">
                        <span class="live-pulse"></span>
                        <span class="live-text">LIVE NOW</span>
                    </div>

                    <!-- Countdown -->
                    <div class="countdown-container">
                        <div id="countdown" class="countdown">
                            <div class="countdown-item">
                                <span id="cd-days">--</span>
                                <span class="countdown-label">dní</span>
                            </div>
                            <div class="countdown-item">
                                <span id="cd-hours">--</span>
                                <span class="countdown-label">hodin</span>
                            </div>
                            <div class="countdown-item">
                                <span id="cd-minutes">--</span>
                                <span class="countdown-label">minut</span>
                            </div>
                            <div class="countdown-item">
                                <span id="cd-seconds">--</span>
                                <span class="countdown-label">sekund</span>
                            </div>
                        </div>
                    </div>

                    <!-- Stream link -->
                    <div class="stream-link-container">
                        <a href="https://www.youtube.com/watch?v=SHtND9QYC8o" id="stream-link" class="stream-link"
                            target="_blank">
                            <i class="fab fa-youtube"></i>
                            <span id="stream-text">Sleduj stream na YouTube</span>
                        </a>

                        <!-- Dodatečné stream info -->
                        <div class="stream-meta hidden" id="streamMeta">
                            <span class="viewers-count" id="viewersCount">• Počet diváků: --</span>
                            <span class="stream-uptime" id="streamUptime">• Stream běží: --</span>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <h2 class="section-title">Nadcházející závody</h2>
        <section class="calendar" id="calendar"></section>

        <a href="calendar.html" class="btn">Zobrazit celý kalendář</a>

        <h2 class="section-title">PRŮBĚŽNÉ POŘADÍ</h2>
        <div class="standings-container">
            <section class="standings">
                <div class="standings-card">
                    <div class="standings-header">
                        <h3>Jezdci</h3>
                    </div>
                    <div class="standings-body">
                        <div class="driver-row">
                            <div class="driver-name">M. Heligr</div>
                            <div class="driver-points">117 bodů</div>
                        </div>
                        <div class="driver-row">
                            <div class="driver-name">M. Klaboch</div>
                            <div class="driver-points">85 bodů</div>
                        </div>
                        <div class="driver-row">
                            <div class="driver-name">J. Kubeš</div>
                            <div class="driver-points">75 bodů</div>
                        </div>
                        <div class="driver-row">
                            <div class="driver-name">F. Kratochvil</div>
                            <div class="driver-points">48 bodů</div>
                        </div>
                        <div class="driver-row">
                            <div class="driver-name">T. Novák</div>
                            <div class="driver-points">44 bodů</div>
                        </div>
                    </div>
                </div>

                <div class="standings-card">
                    <div class="standings-header">
                        <h3>Týmy</h3>
                    </div>
                    <div class="standings-body">
                        <div class="driver-row">
                            <div class="driver-name">McLaren</div>
                            <div class="driver-points">156 bodů</div>
                        </div>
                        <div class="driver-row">
                            <div class="driver-name">Mercedes</div>
                            <div class="driver-points">102 bodů</div>
                        </div>
                        <div class="driver-row">
                            <div class="driver-name">Ferrari</div>
                            <div class="driver-points">97 bodů</div>
                        </div>
                        <div class="driver-row">
                            <div class="driver-name">Aston Martin</div>
                            <div class="driver-points">82 bodů</div>
                        </div>
                        <div class="driver-row">
                            <div class="driver-name">Williams</div>
                            <div class="driver-points">55 bodů</div>
                        </div>
                    </div>
                </div>
            </section>
        </div>
    </div>

    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3>VRL</h3>
                    <p>Virtuální závodní liga pro nadšence Formule 1. Připoj se k nám a zažij motorsport z pohodlí
                        domova.</p>
                    <div class="social-icons">
                        <a href="https://www.instagram.com/vrl_velocityracingleague/"><i
                                class="fab fa-instagram"></i></a>
                        <a href="https://www.youtube.com/@Velocity_Racing_League_VRL"><i class="fab fa-youtube"></i></a>
                        <a href="https://discord.gg/CMxscEUcRd"><i class="fab fa-discord"></i></a>
                        <a href="https://www.tiktok.com/@velocity_racingleague" target="_blank"><i
                                class="fab fa-tiktok"></i></a>
                    </div>
                </div>
                <div class="footer-section">
                    <h3>Navigace</h3>
                    <ul>
                        <li><a href="index.html">Domů</a></li>
                        <li><a href="calendar.html">Kalendář</a></li>
                        <li><a href="jezdci.html">Jezdci</a></li>
                        <li><a href="tymy.html">Týmy</a></li>
                        <li><a href="okruh.html">Okruhy</a></li>
                        <li><a href="vysledky.html">Výsledky</a></li>
                        <li><a href="prihlasky.html">Příhlášky</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h3>Organizátoři</h3>
                    <ul>
                        <li><a href="https://www.instagram.com/matyaasko/">Matěj Vaculík</a></li>
                        <li><a href="https://www.instagram.com/beeeeuuuuu/">Maxim Heligr</a></li>
                        <li><a href="https://www.instagram.com/_.duda.o._/">Ondra Duda</a></li>
                        <li><a href="https://www.instagram.com/klabochmartin?igsh=Ym1pN29hNTFmbjBx&utm_source=qr">Martin
                                Klaboch</a></li>
                        <li><a href="https://www.instagram.com/olinkkt/">Oliver Seidl</a></li>
                    </ul>
                </div>
            </div>
            <div class="copyright">
                <p>&copy; 2025 VRL. Všechna práva vyhrazena.</p>
            </div>
        </div>
    </footer>

    <script src="js/global.js"></script>
    <script>
        // YouTube API konfigurace
        const YOUTUBE_API_KEY = 'AIzaSyB5q7AGW9zjLDOdHj_-IerZwsRmmGcZXKY';
        const YOUTUBE_CHANNEL_ID = 'UC0XDTMlGN34SRTv8upjA1gw';

        // Data závodů - YouTube ID budou doplněna automaticky podle živého streamu
        const races = [
            { round: "R1", name: "Austrálie", date: "2025-09-09", track: "Melbourne Grand Prix Circuit" },
            { round: "R2", name: "Velká Británie", date: "2025-09-16", track: "Silverstone Circuit" },
            { round: "R3", name: "Bahrain", date: "2025-09-30", track: "Bahrain International Circuit" },
            { round: "R4", name: "Miami", date: "2025-10-07", track: "Miami International Autodrome" },
            { round: "R5", name: "Imola", date: "2025-10-14", track: "Autodromo Enzo e Dino Ferrari" },
            { round: "R6", name: "Ázerbájdžán", date: "2025-10-21", track: "Baku City Circuit" },
            { round: "R7", name: "Japonsko", date: "2025-11-04", track: "Suzuka International Racing Course" },
            { round: "R8", name: "Kanada", date: "2025-11-11", track: "Circuit Gilles Villeneuve" },
            { round: "R9", name: "Singapur", date: "2025-11-18", track: "Marina Bay Street Circuit" },
            { round: "R10", name: "Belgie", date: "2025-12-02", track: "Circuit de Spa-Francorchamps" },
            { round: "R11", name: "Španělsko", date: "2025-12-16", track: "Circuit de Barcelona-Catalunya" },
            { round: "R12", name: "Mexiko", date: "2026-01-06", track: "Autódromo Hermanos Rodríguez" },
            { round: "R13", name: "Brazílie", date: "2026-01-20", track: "Autódromo José Carlos Pace" },
            { round: "R14", name: "USA", date: "2026-02-03", track: "Circuit of the Americas" },
            { round: "S1", name: "Sprint Reverse Rakousko", date: "2026-02-17", track: "Red Bull Ring" },
            { round: "R15", name: "Rakousko", date: "2026-02-17", track: "Red Bull Ring" },
            { round: "R16", name: "Monako", date: "2026-03-03", track: "Circuit de Monaco" },
            { round: "R17", name: "Itálie", date: "2026-03-10", track: "Autodromo Nazionale Monza" },
            { round: "R18", name: "Maďarsko", date: "2026-03-24", track: "Hungaroring" },
            { round: "R19", name: "Katar", date: "2026-04-07", track: "Losail International Circuit" },
            { round: "R20", name: "Saudská Arábie", date: "2026-04-21", track: "Jeddah Corniche Circuit" },
            { round: "R21", name: "Abu Dhabi", date: "2026-04-28", track: "Yas Marina Circuit" }
        ];

        // Proměnné pro ukládání stavu streamu
        let currentLiveStream = null;
        let streamCheckInterval = null;

        // Funkce pro získání aktuálního živého streamu z kanálu
        async function getCurrentLiveStream() {
            try {
                const response = await fetch(`https://www.googleapis.com/youtube/v3/search?part=snippet&channelId=${YOUTUBE_CHANNEL_ID}&eventType=live&type=video&key=${YOUTUBE_API_KEY}`);
                const data = await response.json();

                if (data.items && data.items.length > 0) {
                    const liveVideo = data.items[0];
                    return {
                        isLive: true,
                        videoId: liveVideo.id.videoId,
                        title: liveVideo.snippet.title,
                        publishedAt: liveVideo.snippet.publishedAt,
                        channelTitle: liveVideo.snippet.channelTitle
                    };
                }
                return { isLive: false };
            } catch (error) {
                console.error('Chyba při načítání živých streamů:', error);
                return { isLive: false, error: true };
            }
        }

        // Funkce pro získání detailních informací o streamu
        async function getStreamDetails(videoId) {
            try {
                const response = await fetch(`https://www.googleapis.com/youtube/v3/videos?part=liveStreamingDetails,snippet,statistics&id=${videoId}&key=${YOUTUBE_API_KEY}`);
                const data = await response.json();

                if (data.items && data.items.length > 0) {
                    const video = data.items[0];
                    return {
                        concurrentViewers: video.liveStreamingDetails?.concurrentViewers || 0,
                        actualStartTime: video.liveStreamingDetails?.actualStartTime || null,
                        scheduledStartTime: video.liveStreamingDetails?.scheduledStartTime || null,
                        title: video.snippet.title,
                        description: video.snippet.description
                    };
                }
                return null;
            } catch (error) {
                console.error('Chyba při načítání detailů streamu:', error);
                return null;
            }
        }

        // Funkce pro získání aktuálního závodu
        function getCurrentRace() {
            const now = new Date();

            return races
                .map(r => {
                    const raceStart = new Date(`${r.date}T19:00:00`);
                    const raceEnd = new Date(raceStart.getTime() + 3 * 60 * 60 * 1000);
                    return { ...r, raceStart, raceEnd };
                })
                .filter(r => now >= r.raceStart && now <= r.raceEnd)
                .sort((a, b) => a.raceStart - b.raceStart)[0];
        }

        // Funkce pro získání dalšího závodu
        function getNextRace() {
            const currentRace = getCurrentRace();
            const now = new Date();

            if (currentRace) {
                return currentRace;
            }

            return races
                .map(r => {
                    const raceStart = new Date(`${r.date}T19:00:00`);
                    return { ...r, raceStart };
                })
                .filter(r => r.raceStart > now)
                .sort((a, b) => a.raceStart - b.raceStart)[0];
        }

        // Funkce pro získání nadcházejících závodů
        function getUpcomingRaces(excludeRace, limit = null) {
            const now = new Date();
            const currentRace = getCurrentRace();

            const upcoming = races
                .map(r => {
                    const raceStart = new Date(`${r.date}T19:00:00`);
                    return { ...r, raceStart };
                })
                .filter(r => r.raceStart > now)
                .filter(r => !currentRace || r.date !== currentRace.date)
                .sort((a, b) => a.raceStart - b.raceStart);

            return limit ? upcoming.slice(0, limit) : upcoming;
        }

        // Funkce pro vypsání závodů do kalendáře
        function populateCalendar(containerId, racesToShow) {
            const calendar = document.getElementById(containerId);
            calendar.innerHTML = '';

            if (racesToShow.length === 0) {
                calendar.innerHTML = '<div class="no-races">Žádné další nadcházející závody</div>';
                return;
            }

            racesToShow.forEach(race => {
                const raceCard = document.createElement('div');
                raceCard.className = 'race-card';

                raceCard.innerHTML = `
                <div class="race-date">
                    <div class="race-round">${race.round}</div>
                    <strong>${race.raceStart.toLocaleDateString("cs-CZ")}</strong>
                </div>
                <div class="race-info">
                    <h3>${race.name}</h3>
                    <p class="race-track">${race.track}</p>
                    <p>19:00 | Krátká kvalifikace | 50 % Závod</p>
                </div>
            `;

                calendar.appendChild(raceCard);
            });
        }

        // Funkce pro formátování času
        function formatUptime(startTime) {
            const uptime = Math.floor((new Date() - new Date(startTime)) / 1000);
            const hours = Math.floor(uptime / 3600);
            const minutes = Math.floor((uptime % 3600) / 60);
            return `${hours}h ${minutes}m`;
        }

        // Funkce pro analýzu názvu streamu a určení závodu
        function detectRaceFromStream(title) {
            if (!title) return null;

            const titleLower = title.toLowerCase();

            // Prohledáme názvy závodů v názvu streamu
            for (const race of races) {
                const raceNameLower = race.name.toLowerCase();
                if (titleLower.includes(raceNameLower)) {
                    return race;
                }
            }

            return null;
        }

        // Hlavní funkce pro aktualizaci streamu
        async function updateStreamStatus() {
            const nextRace = getNextRace();
            const streamData = await getCurrentLiveStream();

            const countdownEl = document.getElementById('countdown');
            const streamLink = document.getElementById('stream-link');
            const streamText = document.getElementById('stream-text');
            const liveIndicator = document.getElementById('liveIndicator');
            const streamMeta = document.getElementById('streamMeta');
            const nextRaceName = document.getElementById('nextRaceName');
            const nextRaceTrack = document.getElementById('nextRaceTrack');
            const nextRaceDateTime = document.getElementById('nextRaceDateTime');
            const viewersCount = document.getElementById('viewersCount');
            const streamUptime = document.getElementById('streamUptime');

            if (!nextRace) {
                countdownEl.innerHTML = '<div class="no-races">Žádné další závody naplánovány</div>';
                streamLink.style.display = 'none';
                nextRaceName.textContent = "Žádný naplánovaný závod";
                nextRaceTrack.textContent = "---";
                nextRaceDateTime.textContent = "---";
                return;
            }

            // Naplní základní informace o závodě
            nextRaceName.textContent = nextRace.name;
            nextRaceTrack.textContent = nextRace.track;
            nextRaceDateTime.textContent = nextRace.raceStart.toLocaleDateString("cs-CZ", {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });

            const now = new Date();
            const raceStart = nextRace.raceStart;
            const raceEnd = new Date(raceStart.getTime() + 3 * 60 * 60 * 1000);
            const diffToStart = raceStart - now;
            const diffToEnd = raceEnd - now;

            if (streamData.isLive) {
                // SKUTEČNĚ ŽIVÝ STREAM
                currentLiveStream = streamData;

                // Získání detailů streamu
                const streamDetails = await getStreamDetails(streamData.videoId);

                // Aktualizace odkazu na stream
                streamLink.href = `https://www.youtube.com/watch?v=${streamData.videoId}`;

                // Pokus o detekci závodu z názvu streamu
                const detectedRace = detectRaceFromStream(streamData.title);
                if (detectedRace && detectedRace.name !== nextRace.name) {
                    nextRaceName.textContent = detectedRace.name;
                    nextRaceTrack.textContent = detectedRace.track;
                }

                // Zobrazení LIVE indikátoru
                liveIndicator.classList.remove('hidden');
                streamLink.classList.add('live');
                streamText.textContent = 'Sleduj živý přenos';
                streamMeta.classList.remove('hidden');
                countdownEl.style.display = 'none';

                // Aktualizace metadat
                if (streamDetails) {
                    viewersCount.textContent = `• Diváků online: ${streamDetails.concurrentViewers.toLocaleString()}`;
                    if (streamDetails.actualStartTime) {
                        streamUptime.textContent = `• Stream běží: ${formatUptime(streamDetails.actualStartTime)}`;
                    }
                }

            } else if (now >= raceStart && now <= raceEnd) {
                // Časové okno závodu, ale stream není živý
                liveIndicator.classList.remove('hidden');
                liveIndicator.classList.add('preparing');
                liveIndicator.querySelector('.live-text').textContent = 'ČEKÁME NA STREAM';
                streamText.textContent = 'Stream by měl brzy začít';
                streamMeta.classList.add('hidden');
                countdownEl.style.display = 'flex';
                updateCountdownDisplay(diffToEnd);

            } else if (diffToStart <= 15 * 60 * 1000 && diffToStart > 0) {
                // 15 minut před startem
                liveIndicator.classList.remove('hidden');
                liveIndicator.classList.add('preparing');
                liveIndicator.querySelector('.live-text').textContent = 'ZAČÍNÁ BRZY';
                streamText.textContent = 'Připravte se na stream';
                streamMeta.classList.add('hidden');
                countdownEl.style.display = 'flex';
                updateCountdownDisplay(diffToStart);

            } else if (diffToStart <= 0 && diffToEnd <= 0) {
                // Závod skončil
                countdownEl.innerHTML = '<div class="race-finished">Závod byl dokončen</div>';
                streamLink.style.display = 'none';
                liveIndicator.classList.add('hidden');

            } else {
                // Normální countdown
                liveIndicator.classList.remove('preparing');
                liveIndicator.classList.add('hidden');
                streamLink.classList.remove('live');
                streamText.textContent = 'Sleduj stream na YouTube';
                streamMeta.classList.add('hidden');
                countdownEl.style.display = 'flex';
                updateCountdownDisplay(diffToStart);
            }

            function updateCountdownDisplay(diff) {
                const isNegative = diff < 0;
                const absDiff = Math.abs(diff);

                const days = Math.floor(absDiff / (1000 * 60 * 60 * 24));
                const hours = Math.floor((absDiff / (1000 * 60 * 60)) % 24);
                const minutes = Math.floor((absDiff / (1000 * 60)) % 60);
                const seconds = Math.floor((absDiff / 1000) % 60);

                document.getElementById('cd-days').textContent = String(days).padStart(2, '0');
                document.getElementById('cd-hours').textContent = String(hours).padStart(2, '0');
                document.getElementById('cd-minutes').textContent = String(minutes).padStart(2, '0');
                document.getElementById('cd-seconds').textContent = String(seconds).padStart(2, '0');
            }
        }

        // Inicializace stránky
        document.addEventListener("DOMContentLoaded", async () => {
            // První načtení stavu streamu
            await updateStreamStatus();

            // Pravidelné aktualizace streamu (každých 30 sekund)
            streamCheckInterval = setInterval(updateStreamStatus, 30000);

            // Nadcházející závody
            const nextRace = getNextRace();
            const upcomingRaces = getUpcomingRaces(nextRace, 5);
            populateCalendar("calendar", upcomingRaces);

            // Automatické obnovení seznamu závodů
            function scheduleRefresh() {
                setTimeout(() => {
                    const newNextRace = getNextRace();
                    const newUpcomingRaces = getUpcomingRaces(newNextRace, 5);
                    populateCalendar("calendar", newUpcomingRaces);
                    scheduleRefresh();
                }, 60000);
            }

            scheduleRefresh();
        });

        // Scrollování headeru na mobilu
        let lastScrollTop = 0;
        const header = document.querySelector('header');

        window.addEventListener('scroll', () => {
            const st = window.pageYOffset || document.documentElement.scrollTop;

            if (window.innerWidth <= 768) {
                if (st > lastScrollTop) {
                    header.style.top = "-120px";
                } else {
                    header.style.top = "0";
                }
            }

            lastScrollTop = st <= 0 ? 0 : st;
        });
    </script>
</body>

</html>
