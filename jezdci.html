<!DOCTYPE html>
<html lang="cs">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VRL - Velocity Racing League - Season 2</title>
    <link rel="icon" type="image/png" href="VRL_logo_nove.png">

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- Vlajky -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flag-icons/css/flag-icons.min.css">

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- Vlastní CSS -->
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <!-- HEADER -->
    <header>
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <a href="index.html">
                        <img src="vrl_high_res.png" alt="F1 VRL Logo" class="logo-img">
                    </a>
                </div>
                <div class="header-controls">
                    <button class="theme-switch" id="themeSwitch">
                        <i class="fas fa-moon"></i>
                    </button>
                    <button class="mobile-menu-toggle" id="mobileMenuToggle">
                        <span></span>
                        <span></span>
                        <span></span>
                    </button>
                </div>
                <nav id="mobileNav">
                    <ul>
                        <li><a href="index.html">Domů</a></li>
                        <li><a href="calendar.html">Kalendář</a></li>
                        <li><a href="jezdci.html">Jezdci</a></li>
                        <li><a href="tymy.html">Týmy</a></li>
                        <li><a href="okruh.html">Okruhy</a></li>
                        <li><a href="vysledky.html">Výsledky</a></li>
                        <li><a href="prihlasky.html">Příhlášky</a></li>
                        <li><a href="https://discord.gg/CMxscEUcRd" class="discord-btn"><i class="fab fa-discord"></i>
                                Discord</a></li>
                    </ul>
                </nav>
            </div>
        </div>
    </header>

    <!-- HERO -->
    <section class="hero">
        <div class="hero-fade"></div>
        <div class="container">
            <div class="hero-content">
                <h2>Velocity Racing League</h2>
                <p>Zjisti jak to jde naším jezdcům a taky tvým oblíbeným jezdcům.</p>
                <div>
                    <a href="https://discord.gg/CMxscEUcRd" class="btn"><i class="fab fa-discord"></i> Připojit se na
                        Discord</a>
                </div>
            </div>
        </div>
    </section>

    <!-- MAIN -->
    <main>
        <!-- SEKCHE PRO OBLÍBENÉHO JEZDCE -->
        <h2 class="table-title">Oblíbený jezdec</h2>
        <section class="favorite-driver-section">
            <div class="driver-selector">
                <select id="favoriteDriverSelect">
                    <option value="">Vyberte svého oblíbeného jezdce</option>
                </select>
            </div>

            <div id="favoriteDriverCard" class="favorite-driver-card" style="display: none;">
                <div class="favorite-driver-info">
                    <div class="favorite-driver-name">
                        <span id="favDriverName"></span>
                        <span class="favorite-badge">OBLÍBENÝ</span>
                    </div>
                    <div>Tým: <strong id="favDriverTeam"></strong></div>
                    <div>Číslo: <strong id="favDriverNumber"></strong></div>
                    <div>Země: <span id="favDriverCountry"></span></div>

                    <div class="favorite-driver-details">
                        <div class="favorite-driver-detail">
                            <div>Pořadí</div>
                            <div><strong id="favDriverPosition"></strong></div>
                        </div>
                        <div class="favorite-driver-detail">
                            <div>Body</div>
                            <div><strong id="favDriverPoints"></strong></div>
                        </div>
                        <div class="favorite-driver-detail">
                            <div>1. místa</div>
                            <div><strong id="favDriverWins"></strong></div>
                        </div>
                        <div class="favorite-driver-detail">
                            <div>2. místa</div>
                            <div><strong id="favDriverSecond"></strong></div>
                        </div>
                        <div class="favorite-driver-detail">
                            <div>3. místa</div>
                            <div><strong id="favDriverThird"></strong></div>
                        </div>
                    </div>
                </div>

                <!-- Sekce pro porovnání s dalšími jezdci -->
                <div class="comparison-section">
                    <h3>Porovnat s dalšími jezdci</h3>
                    <div class="comparison-controls">
                        <select id="comparisonDriverSelect">
                            <option value="">Vyberte jezdce k porovnání</option>
                        </select>
                        <button id="addComparisonBtn" class="btn-small">Přidat</button>
                    </div>

                    <div class="comparison-drivers-container" id="comparisonDriversContainer">
                        <!-- Zde se zobrazí jezdci přidaní k porovnání -->
                    </div>

                    <div class="comparison-actions">
                        <button id="showComparisonBtn" class="btn" style="display: none;">Zobrazit porovnání</button>
                        <button id="clearComparisonBtn" class="btn" style="display: none;">Vyčistit porovnání</button>
                    </div>
                </div>
            </div>
        </section>

        <!-- GRAF BODŮ -->
        <section class="points-chart-section" id="pointsChartSection" style="display: none;">
            <h2 class="table-title">Porovnání bodů jezdců</h2>
            <div class="chart-container">
                <canvas id="pointsChart"></canvas>
            </div>
        </section>

        <h2 class="table-title">Pořadí jezdců</h2>
        <table class="drivers-table">
            <thead>
                <tr>
                    <th>Pořadí</th>
                    <th>#</th>
                    <th>Jméno</th>
                    <th>Tým</th>
                    <th>Země</th>
                    <th>Body</th>
                    <th>Ztráta</th>
                    <th>1. místa</th>
                    <th>2. místa</th>
                    <th>3. místa</th>
                </tr>
            </thead>

            <tbody id="driversTable">
                <!-- JS doplní jezdce -->
            </tbody>
        </table>
    </main>

    <!-- FOOTER -->
    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3>VRL</h3>
                    <p>Virtuální závodní liga pro nadšence Formule 1. Připoj se k nám a zažij motorsport z pohodlí
                        domova.</p>
                    <div class="social-icons">
                        <a href="https://www.instagram.com/vrl_velocityracingleague/"><i
                                class="fab fa-instagram"></i></a>
                        <a href="https://www.youtube.com/@Velocity_Racing_League_VRL"><i class="fab fa-youtube"></i></a>
                        <a href="https://discord.gg/CMxscEUcRd"><i class="fab fa-discord"></i></a>
                        <a href="https://www.tiktok.com/@velocity_racingleague" target="_blank"><i
                                class="fab fa-tiktok"></i></a>
                    </div>
                </div>
                <div class="footer-section">
                    <h3>Navigace</h3>
                    <ul>
                        <li><a href="index.html">Domů</a></li>
                        <li><a href="calendar.html">Kalendář</a></li>
                        <li><a href="jezdci.html">Jezdci</a></li>
                        <li><a href="tymy.html">Týmy</a></li>
                        <li><a href="okruh.html">Okruhy</a></li>
                        <li><a href="vysledky.html">Výsledky</a></li>
                        <li><a href="prihlasky.html">Příhlášky</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h3>Organizátoři</h3>
                    <ul>
                        <li><a href="https://www.instagram.com/matyaasko/">Matěj Vaculík</a></li>
                        <li><a href="https://www.instagram.com/beeeeuuuuu/">Maxim Heligr</a></li>
                        <li><a href="https://www.instagram.com/_.duda.o._/">Ondra Duda</a></li>
                        <li><a href="https://www.instagram.com/klabochmartin?igsh=Ym1pN29hNTFmbjBx&utm_source=qr">Martin
                                Klaboch</a></li>
                        <li><a href="https://www.instagram.com/olinkkt/">Oliver Seidl</a></li>
                    </ul>
                </div>
            </div>
            <div class="copyright">
                <p>&copy; 2025 VRL. Všechna práva vyhrazena.</p>
            </div>
        </div>
    </footer>

    <!-- Skripty -->
    <script src="js/global.js"></script>
    <script>
        // Rozšířená data jezdců s historií bodů podle skutečných závodů
        const drivers = [
            {
                number: 71, name: "Petr Stouhal", team: "Red Bull", country: "cz", points: 0, wins: 0, second: 0, third: 0,
                pointsHistory: [0, 0, 0, 0, 0, 0, 0, 0, 0]
            },
            {
                number: 7, name: "Josef Kubeš", team: "Ferrari", country: "cz", points: 109, wins: 1, second: 1, third: 0,
                pointsHistory: [25, 37, 45, 47, 57, 75, 87, 97, 109]
            },
            {
                number: 2, name: "Zdeněk Pohlreich", team: "Mercedes", country: "cz", points: 25, wins: 0, second: 0, third: 0,
                pointsHistory: [0, 0, 2, 2, 17, 17, 17, 17, 25]
            },
            {
                number: 1, name: "Maxim Heligr", team: "McLaren", country: "cz", points: 150, wins: 3, second: 1, third: 3,
                pointsHistory: [15, 40, 65, 90, 102, 117, 135, 150, 150]
            },
            {
                number: 56, name: "Filip Kratochvil", team: "Aston Martin", country: "cz", points: 73, wins: 2, second: 0, third: 1,
                pointsHistory: [0, 8, 8, 23, 48, 48, 73, 73, 73]
            },
            {
                number: 24, name: "Viktor Koutný", team: "Alpine", country: "cz", points: 0, wins: 0, second: 0, third: 0,
                pointsHistory: [0, 0, 0, 0, 0, 0, 0, 0, 0]
            },
            {
                number: 97, name: "Andrej Erdelský", team: "Racing Bulls", country: "sk", points: 31, wins: 0, second: 0, third: 0,
                pointsHistory: [8, 10, 10, 14, 14, 18, 20, 21, 31]
            },
            {
                number: 20, name: "Tomáš Novák", team: "Haas", country: "cz", points: 54, wins: 0, second: 1, third: 0,
                pointsHistory: [4, 10, 20, 26, 44, 44, 44 ,48, 54]
            },
            {
                number: 19, name: "Ján Bubák", team: "Williams", country: "sk", points: 1, wins: 0, second: 0, third: 0,
                pointsHistory: [0, 0, 0, 0, 0, 0, 1, 1, 1]
            },
            {
                number: 99, name: "Jakub Fabian", team: "Sauber", country: "cz", points: 38, wins: 0, second: 1, third: 0,
                pointsHistory: [0, 1, 2, 2, 2, 12, 18, 20, 38]
            },
            {
                number: 13, name: "Oscar Anděl", team: "Red Bull", country: "cz", points: 0, wins: 0, second: 0, third: 0,
                pointsHistory: [0, 0, 0, 0, 0, 0, 0, 0, 0]
            },
            {
                number: 28, name: "Luboš Novotný", team: "Ferrari", country: "cz", points: 12, wins: 0, second: 0, third: 0,
                pointsHistory: [0, 4, 4, 4, 4, 12, 12, 12, 12]
            },
            {
                number: 12, name: "Martin Klaboch", team: "Mercedes", country: "cz", points: 132, wins: 2, second: 3, third: 0,
                pointsHistory: [18, 36, 54, 54, 60, 85, 95, 107, 132]
            },
            {
                number: 96, name: "Matěj Vaculík", team: "McLaren", country: "cz", points: 60, wins: 0, second: 0, third: 2,
                pointsHistory: [2, 17, 23, 33, 33, 39, 54, 60, 60]
            },
            {
                number: 4, name: "Max Novotný", team: "Williams", country: "cz", points: 25, wins: 1, second: 0, third: 0,
                pointsHistory: [0, 0, 0, 0, 0, 0, 0, 25, 25]
            },
            {
                number: 11, name: "Oliver Čobrde", team: "Alpine", country: "sk", points: 4, wins: 0, second: 0, third: 0,
                pointsHistory: [0, 0, 0, 0, 0, 0, 4, 4, 4]
            },
            {
                number: 67, name: "Jáchym Majvald", team: "Racing Bulls", country: "cz", points: 0, wins: 0, second: 0, third: 0,
                pointsHistory: [0, 0, 0, 0, 0, 0, 0, 0, 0]
            },
            {
                number: 25, name: "Matěj Švec", team: "Haas", country: "cz", points: 1, wins: 0, second: 0, third: 0,
                pointsHistory: [0, 0, 0, 0, 1, 1, 1, 1, 1]
            },
            {
                number: 26, name: "Matyáš Kasl", team: "Aston Martin", country: "cz", points: 33, wins: 0, second: 1, third: 1,
                pointsHistory: [0, 0, 15, 15, 15, 15, 15, 33, 33]
            },
            {
                number: 66, name: "Oliver Stavač", team: "Sauber", country: "sk", points: 59, wins: 0, second: 0, third: 1,
                pointsHistory: [0, 0, 4, 12, 16, 28, 36, 44, 59]
            },
            {
                number: 21, name: "Adam Gallus", team: "Záloha", country: "cz", points: 0, wins: 0, second: 0, third: 0,
                pointsHistory: [0, 0, 0, 0, 0, 0, 0, 0, 0]
            }
        ];

        // Názvy závodů pro graf - pouze 6 odehraných závodů
        const raceNames = ["R1", "R2", "R3", "R4", "R5", "R6", "R7", "R8", "R9"];

        // Proměnné pro správu vybraných jezdců
        let favoriteDriver = null;
        let comparisonDrivers = [];
        let pointsChart = null;

        // Naplníme select s jezdci pro oblíbeného jezdce
        function initializeDriverSelects() {
            const favoriteSelect = document.getElementById('favoriteDriverSelect');
            favoriteSelect.innerHTML = '<option value="">Vyberte svého oblíbeného jezdce</option>';

            drivers.forEach(driver => {
                const option = document.createElement('option');
                option.value = driver.number;
                option.textContent = `${driver.number} - ${driver.name} (${driver.team})`;
                favoriteSelect.appendChild(option);
            });

            updateComparisonSelect();
        }

        // Naplníme select s jezdci pro porovnání (bez oblíbeného jezdce)
        function updateComparisonSelect() {
            const comparisonSelect = document.getElementById('comparisonDriverSelect');
            comparisonSelect.innerHTML = '<option value="">Vyberte jezdce k porovnání</option>';

            drivers.forEach(driver => {
                // Přidáme všechny jezdce kromě oblíbeného
                if (!favoriteDriver || driver.number !== favoriteDriver.number) {
                    const option = document.createElement('option');
                    option.value = driver.number;
                    option.textContent = `${driver.number} - ${driver.name} (${driver.team})`;
                    comparisonSelect.appendChild(option);
                }
            });
        }

        // Funkce pro zobrazení oblíbeného jezdce
        function displayFavoriteDriver(driverNumber) {
            const driver = drivers.find(d => d.number == driverNumber);
            if (!driver) return;

            // Najdeme pozici jezdce v pořadí
            const sortedDrivers = [...drivers].sort((a, b) => {
                if (b.points !== a.points) return b.points - a.points;
                if (b.wins !== a.wins) return b.wins - a.wins;
                if (b.second !== a.second) return b.second - a.second;
                return b.third - a.third;
            });

            const position = sortedDrivers.findIndex(d => d.number == driverNumber) + 1;
            const leaderPoints = sortedDrivers[0].points;
            const loss = leaderPoints - driver.points;

            // Naplníme data do karty
            document.getElementById('favDriverName').textContent = driver.name;
            document.getElementById('favDriverTeam').textContent = driver.team;
            document.getElementById('favDriverNumber').textContent = driver.number;
            document.getElementById('favDriverCountry').innerHTML = `<span class="fi fi-${driver.country}"></span>`;
            document.getElementById('favDriverPosition').textContent = position + '. místo';
            document.getElementById('favDriverPoints').textContent = driver.points;
            document.getElementById('favDriverWins').textContent = driver.wins;
            document.getElementById('favDriverSecond').textContent = driver.second;
            document.getElementById('favDriverThird').textContent = driver.third;

            // Zobrazíme kartu
            document.getElementById('favoriteDriverCard').style.display = 'flex';

            // Uložíme do localStorage
            localStorage.setItem('favoriteDriver', driverNumber);

            // Nastavíme oblíbeného jezdce a aktualizujeme select pro porovnání
            favoriteDriver = driver;
            updateComparisonSelect();

            // Vyčistíme porovnání při změně oblíbeného jezdce
            comparisonDrivers = [];
            updateComparisonDisplay();
            updateComparisonActions();
        }

        // Přidání jezdce k porovnání
        function addComparisonDriver() {
            const comparisonSelect = document.getElementById('comparisonDriverSelect');
            const selectedDriverNumber = comparisonSelect.value;
            if (!selectedDriverNumber) return;

            const driver = drivers.find(d => d.number == selectedDriverNumber);
            if (!driver) return;

            // Kontrola, zda už není vybrán
            if (comparisonDrivers.some(d => d.number == driver.number)) {
                alert('Tento jezdec je již vybrán k porovnání.');
                return;
            }

            comparisonDrivers.push(driver);
            updateComparisonDisplay();
            updateComparisonActions();

            // Vyčistíme select
            comparisonSelect.value = '';
        }

        // Aktualizace zobrazení jezdců k porovnání
        function updateComparisonDisplay() {
            const container = document.getElementById('comparisonDriversContainer');
            container.innerHTML = '';

            comparisonDrivers.forEach((driver, index) => {
                const driverCard = document.createElement('div');
                driverCard.className = 'comparison-driver-card';
                driverCard.innerHTML = `
                    <div class="comparison-driver-info">
                        <div class="comparison-driver-name">
                            <span>${driver.name}</span>
                            <span class="driver-number">#${driver.number}</span>
                        </div>
                        <div>Tým: <strong>${driver.team}</strong></div>
                        <div>Body: <strong>${driver.points}</strong></div>
                    </div>
                    <button class="remove-comparison-btn" data-index="${index}" title="Odebrat jezdce">
                        <i class="fas fa-times"></i>
                    </button>
                `;
                container.appendChild(driverCard);
            });

            // Přidání event listenerů pro tlačítka odstranění
            document.querySelectorAll('.remove-comparison-btn').forEach(btn => {
                btn.addEventListener('click', function () {
                    const index = parseInt(this.getAttribute('data-index'));
                    comparisonDrivers.splice(index, 1);
                    updateComparisonDisplay();
                    updateComparisonActions();

                    // Pokud nejsou vybráni žádní jezdci, skryjeme graf
                    if (comparisonDrivers.length === 0) {
                        document.getElementById('pointsChartSection').style.display = 'none';
                    }
                });
            });
        }

        // Aktualizace ovládacích prvků porovnání
        function updateComparisonActions() {
            const showBtn = document.getElementById('showComparisonBtn');
            const clearBtn = document.getElementById('clearComparisonBtn');

            if (comparisonDrivers.length > 0) {
                showBtn.style.display = 'inline-block';
                clearBtn.style.display = 'inline-block';
            } else {
                showBtn.style.display = 'none';
                clearBtn.style.display = 'none';
            }
        }

        function showComparisonChart() {
            if (!favoriteDriver || comparisonDrivers.length === 0) return;

            // Nejprve zobrazíme sekci
            document.getElementById('pointsChartSection').style.display = 'block';

            // Poté s malým zpožděním vytvoříme graf, aby se canvas stihl zobrazit
            setTimeout(() => {
                createPointsChart();
            }, 100);

            // Scroll k grafu
            document.getElementById('pointsChartSection').scrollIntoView({ behavior: 'smooth' });
        }

        // Vyčištění porovnání
        function clearComparison() {
            comparisonDrivers = [];
            updateComparisonDisplay();
            updateComparisonActions();
            document.getElementById('pointsChartSection').style.display = 'none';
        }

        // Vytvoření grafu bodů - OPRAVENÁ VERZE
        function createPointsChart() {
            const canvas = document.getElementById('pointsChart');
            if (!canvas) return;

            const ctx = canvas.getContext('2d');

            // Zajistíme ostrý rendering na vysokých DPI displejích
            const dpr = window.devicePixelRatio || 1;
            const rect = canvas.parentElement.getBoundingClientRect();

            // Nastavíme správnou velikost canvasu
            canvas.width = rect.width * dpr;
            canvas.height = rect.height * dpr;
            canvas.style.width = rect.width + 'px';
            canvas.style.height = rect.height + 'px';

            // Scale the context
            ctx.scale(dpr, dpr);

            // Pokud již existuje graf, zničíme ho
            if (pointsChart) {
                pointsChart.destroy();
            }

            // Vytvoříme pole všech jezdců k zobrazení (oblíbený + porovnávaní)
            const driversToShow = [favoriteDriver, ...comparisonDrivers];

            // Příprava dat pro graf
            const datasets = driversToShow.map((driver, index) => {
                // Barvy pro různé jezdce
                const colors = [
                    'rgba(255, 215, 0, 1)', // Zlatá pro oblíbeného jezdce
                    'rgba(255, 99, 132, 1)',
                    'rgba(54, 162, 235, 1)',
                    'rgba(255, 206, 86, 1)',
                    'rgba(75, 192, 192, 1)',
                    'rgba(153, 102, 255, 1)'
                ];

                // Speciální styl pro oblíbeného jezdce
                const isFavorite = index === 0;

                return {
                    label: `${driver.name} (${driver.team})${isFavorite ? ' ⭐' : ''}`,
                    data: driver.pointsHistory,
                    borderColor: colors[index % colors.length],
                    backgroundColor: colors[index % colors.length].replace('1)', '0.1)'),
                    borderWidth: isFavorite ? 3 : 2,
                    pointBackgroundColor: colors[index % colors.length],
                    pointBorderColor: '#fff',
                    pointBorderWidth: 2,
                    pointRadius: isFavorite ? 6 : 5,
                    pointHoverRadius: isFavorite ? 8 : 7,
                    tension: 0.1,
                    fill: false
                };
            });

            // Vytvoření grafu
            pointsChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: raceNames,
                    datasets: datasets
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    devicePixelRatio: dpr,
                    plugins: {
                        title: {
                            display: false
                        },
                        legend: {
                            position: 'top',
                            labels: {
                                usePointStyle: true,
                                pointStyle: 'circle',
                                padding: 15,
                                boxWidth: 12,
                                boxHeight: 12,
                                font: {
                                    size: window.innerWidth <= 768 ? 10 : 12
                                }
                            }
                        },
                        tooltip: {
                            mode: 'index',
                            intersect: false,
                            backgroundColor: 'rgba(0, 0, 0, 0.8)',
                            titleFont: {
                                size: 12
                            },
                            bodyFont: {
                                size: 11
                            },
                            padding: 10
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Celkové body',
                                font: {
                                    size: window.innerWidth <= 768 ? 11 : 12
                                }
                            },
                            ticks: {
                                font: {
                                    size: window.innerWidth <= 768 ? 10 : 11
                                }
                            },
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'Závody',
                                font: {
                                    size: window.innerWidth <= 768 ? 11 : 12
                                }
                            },
                            ticks: {
                                font: {
                                    size: window.innerWidth <= 768 ? 10 : 11
                                },
                                maxRotation: window.innerWidth <= 768 ? 45 : 0
                            },
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            }
                        }
                    },
                    interaction: {
                        intersect: false,
                        mode: 'nearest'
                    }
                }
            });
        }

        // Funkce pro opětovné vykreslení grafu při změně velikosti okna
        function handleResize() {
            if (pointsChart) {
                pointsChart.destroy();
                setTimeout(() => {
                    createPointsChart();
                }, 100);
            }
        }

        // Vykreslení hlavní tabulky jezdců
        function renderDriversTable() {
            const sortedDrivers = [...drivers].sort((a, b) => {
                if (b.points !== a.points) return b.points - a.points;
                if (b.wins !== a.wins) return b.wins - a.wins;
                if (b.second !== a.second) return b.second - a.second;
                return b.third - a.third;
            });

            const leaderPoints = sortedDrivers[0].points;
            const table = document.getElementById("driversTable");
            const savedFavorite = localStorage.getItem('favoriteDriver');

            table.innerHTML = '';

            sortedDrivers.forEach((driver, index) => {
                const loss = leaderPoints - driver.points;
                const isFavorite = driver.number == savedFavorite;

                const row = document.createElement("tr");
                if (isFavorite) {
                    row.style.background = 'rgba(255, 215, 0, 0.1)';
                    row.style.fontWeight = 'bold';
                }

                row.innerHTML = `
                    <td><strong>${index + 1}</strong></td>
                    <td>${driver.number}</td>
                    <td>${driver.name} ${isFavorite ? '⭐' : ''}</td>
                    <td>${driver.team}</td>
                    <td><span class="fi fi-${driver.country}"></span></td>
                    <td><strong>${driver.points}</strong></td>
                    <td>${loss === 0 ? "-" : loss}</td>
                    <td>${driver.wins}</td>
                    <td>${driver.second}</td>
                    <td>${driver.third}</td>
                `;
                table.appendChild(row);
            });
        }

        // Inicializace po načtení stránky
        document.addEventListener('DOMContentLoaded', () => {
            // Inicializace selectů
            initializeDriverSelects();

            // Načtení uloženého oblíbeného jezdce
            const savedFavorite = localStorage.getItem('favoriteDriver');
            if (savedFavorite) {
                const favoriteSelect = document.getElementById('favoriteDriverSelect');
                favoriteSelect.value = savedFavorite;
                displayFavoriteDriver(savedFavorite);
            }

            // Vykreslení tabulky
            renderDriversTable();

            // Event listenery
            document.getElementById('favoriteDriverSelect').addEventListener('change', function () {
                if (this.value) {
                    displayFavoriteDriver(this.value);
                } else {
                    document.getElementById('favoriteDriverCard').style.display = 'none';
                    localStorage.removeItem('favoriteDriver');
                    favoriteDriver = null;
                    updateComparisonSelect();
                    renderDriversTable(); // Překreslíme tabulku bez zvýraznění
                }
            });

            document.getElementById('addComparisonBtn').addEventListener('click', addComparisonDriver);
            document.getElementById('showComparisonBtn').addEventListener('click', showComparisonChart);
            document.getElementById('clearComparisonBtn').addEventListener('click', clearComparison);

            // Resize handler
            let resizeTimeout;
            window.addEventListener('resize', function () {
                clearTimeout(resizeTimeout);
                resizeTimeout = setTimeout(handleResize, 250);
            });
        });
    </script>
</body>

</html>
